const a7_0x37ea=['Processing\x20task\x20','parse','start','write','note','__esModule','stdout','executionId:\x20','Command\x20execution\x20failed.','commandStatus','ErrorReporterApi','./task-graph-creator','project','../../file-storage/file-storage','Unable\x20to\x20complete\x20a\x20run.','log','encryptionKey','DistributedExecutionApi','strip-json-comments','ENCRYPTION_KEY','VERBOSE_LOGGING','executionStatus:\x20','completeRunGroupWithError','logCommand','values','push','cacheDirectory','/nx.json','TaskGraphCreator','copyFilesFromCache','nxCloudDistributedTasksRunner','completedTasks','executionStatus','taskGraph','error','criticalErrorMessage','reset','Waiter','addVerticalSeparator','Starting\x20distributed\x20command\x20execution','submitRunMetrics','../../../utilities/serializer-overrides','retrieve','value','get','url','number\x20of\x20completed\x20tasks:\x20','nodes','Waiting...','Status\x20update','Found\x20unknown\x20task:\x20','../../error/print-run-group-error','Retrieving\x20artifacts\x20from\x20','message','assign','createNoNewMessagesTimeout','./node_modules/.cache/nx','hash','length','projectGraph','createTaskGraph','axiosException','terminalOutput','Error:','Distributed\x20Execution\x20Terminated','runUrl','__awaiter','splitTasksIntoStages','Main\x20job\x20terminated\x20with\x20an\x20error:\x20\x22','../../../utilities/nx-imports','next','serializeOverrides','target','configuration','createStartRequest','scheduleTask','targetDependencies','startTask','exit','dependencies','../../../utilities/create-no-new-messages-timeout','../../../utilities/waiter','Successfully\x20completed\x20running\x20the\x20command.','taskId'];(function(_0x52e5f3,_0x37ea81){const _0x21105f=function(_0x5f1313){while(--_0x5f1313){_0x52e5f3['push'](_0x52e5f3['shift']());}};_0x21105f(++_0x37ea81);}(a7_0x37ea,0x1c0));const a7_0x2110=function(_0x52e5f3,_0x37ea81){_0x52e5f3=_0x52e5f3-0x0;let _0x21105f=a7_0x37ea[_0x52e5f3];return _0x21105f;};'use strict';var __awaiter=this&&this[a7_0x2110('0x26')]||function(_0x1a56e7,_0x2ddfa9,_0x47676e,_0x59c121){function _0x57a7dc(_0x1c6467){return _0x1c6467 instanceof _0x47676e?_0x1c6467:new _0x47676e(function(_0x4d08e9){_0x4d08e9(_0x1c6467);});}return new(_0x47676e||(_0x47676e=Promise))(function(_0x248065,_0x2a5ebd){function _0xac444f(_0x557861){try{_0x4fb081(_0x59c121['next'](_0x557861));}catch(_0x4baa0b){_0x2a5ebd(_0x4baa0b);}}function _0x6b403c(_0x148063){try{_0x4fb081(_0x59c121['throw'](_0x148063));}catch(_0x569192){_0x2a5ebd(_0x569192);}}function _0x4fb081(_0x2aa6ae){_0x2aa6ae['done']?_0x248065(_0x2aa6ae[a7_0x2110('0xf')]):_0x57a7dc(_0x2aa6ae['value'])['then'](_0xac444f,_0x6b403c);}_0x4fb081((_0x59c121=_0x59c121['apply'](_0x1a56e7,_0x2ddfa9||[]))[a7_0x2110('0x2a')]());});};Object['defineProperty'](exports,a7_0x2110('0x3d'),{'value':!![]});exports[a7_0x2110('0x2')]=void 0x0;const stripJsonComments=require(a7_0x2110('0x4a'));const fs_1=require('fs');const distributed_execution_api_1=require('./distributed-execution.api');const file_storage_1=require(a7_0x2110('0x45'));const e2e_encryption_1=require('../../file-storage/e2e-encryption');const waiter_1=require(a7_0x2110('0x35'));const environment_1=require('../../../utilities/environment');const print_run_group_error_1=require(a7_0x2110('0x17'));const create_no_new_messages_timeout_1=require(a7_0x2110('0x34'));const metric_logger_1=require('../../../utilities/metric-logger');const error_reporter_api_1=require('../../api/error-reporter.api');const serializer_overrides_1=require(a7_0x2110('0xd'));const task_graph_creator_1=require(a7_0x2110('0x43'));const split_task_graph_into_stages_1=require('./split-task-graph-into-stages');const {output,workspaceRoot,getOutputs,Cache}=require(a7_0x2110('0x29'));class NoopLifeCycle{[a7_0x2110('0x2f')](_0x1b277b){}[a7_0x2110('0x31')](_0x26ca54){}['endTask'](_0x33e2b2,_0x303a28){}}function runDistributedExecution(_0x4d3098,_0x297729,_0x54791c,_0x158def,_0x2c6984,_0x2af478,_0x548078){return __awaiter(this,void 0x0,void 0x0,function*(){const _0xfbbef3=yield _0x4d3098[a7_0x2110('0x3a')]((0x0,distributed_execution_api_1[a7_0x2110('0x2e')])(_0x2af478,(0x0,split_task_graph_into_stages_1[a7_0x2110('0x27')])(_0x548078),_0x297729));return yield processTasks(_0x4d3098,_0x158def,_0x2c6984,_0x297729,_0xfbbef3,Object[a7_0x2110('0x50')](_0x548078['tasks']),_0x54791c);});}function processTasks(_0x215c04,_0x36e60e,_0x328fd1,_0x40885a,_0x2bc7e2,_0x402edd,_0x229fb6){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4e6094={};const _0x494780=(0x0,create_no_new_messages_timeout_1[a7_0x2110('0x1b')])();const _0xbe69cb=new waiter_1[(a7_0x2110('0x9'))]();while(!![]){if(environment_1[a7_0x2110('0x4c')]){output['note']({'title':a7_0x2110('0x14')});}yield _0xbe69cb['wait']();const _0x22655e=yield _0x215c04['status'](_0x2bc7e2);if(environment_1[a7_0x2110('0x4c')]){output['note']({'title':a7_0x2110('0x15'),'bodyLines':[a7_0x2110('0x3f')+_0x2bc7e2,a7_0x2110('0x4d')+_0x22655e[a7_0x2110('0x4')],a7_0x2110('0x12')+_0x22655e[a7_0x2110('0x3')][a7_0x2110('0x1e')],'error:\x20'+_0x22655e[a7_0x2110('0x7')]]});}if(_0x22655e[a7_0x2110('0x7')]){output[a7_0x2110('0x6')]({'title':a7_0x2110('0x24'),'bodyLines':[a7_0x2110('0x23'),_0x22655e['criticalErrorMessage']]});process[a7_0x2110('0x32')](0x1);}_0x494780(_0x22655e[a7_0x2110('0x3')][a7_0x2110('0x1e')]);for(const _0x3f90fc of _0x22655e[a7_0x2110('0x3')]){if(_0x4e6094[_0x3f90fc[a7_0x2110('0x37')]])continue;yield processTask(_0x36e60e,_0x328fd1,_0x229fb6,_0x40885a,_0x402edd,_0x3f90fc);_0xbe69cb[a7_0x2110('0x8')]();_0x4e6094[_0x3f90fc[a7_0x2110('0x37')]]=!![];}if(_0x22655e[a7_0x2110('0x4')]==='COMPLETED'){return{'commandStatus':_0x22655e[a7_0x2110('0x41')],'runUrl':_0x22655e[a7_0x2110('0x25')]};}}});}function processTask(_0x1aa5df,_0x4803f5,_0x3a6aab,_0x4f823f,_0x2f9376,_0x12407b){return __awaiter(this,void 0x0,void 0x0,function*(){if(environment_1[a7_0x2110('0x4c')]){output[a7_0x2110('0x3c')]({'title':a7_0x2110('0x38')+_0x12407b[a7_0x2110('0x37')]});}const _0x417e9a=_0x2f9376['find'](_0x19394b=>_0x12407b[a7_0x2110('0x37')]===_0x19394b['id']);if(!_0x417e9a){throw new Error(a7_0x2110('0x16')+_0x12407b[a7_0x2110('0x37')]);}if(environment_1[a7_0x2110('0x4c')]){output[a7_0x2110('0x3c')]({'title':a7_0x2110('0x18')+_0x12407b[a7_0x2110('0x11')]});}yield _0x1aa5df[a7_0x2110('0xe')](_0x12407b['hash'],_0x12407b[a7_0x2110('0x11')],_0x4f823f[a7_0x2110('0x52')]||a7_0x2110('0x1c'));const _0x444ddf=yield _0x4803f5[a7_0x2110('0x10')](Object[a7_0x2110('0x1a')](Object['assign']({},_0x417e9a),{'hash':_0x12407b[a7_0x2110('0x1d')]}));const _0x569ddc=getOutputs(_0x3a6aab[a7_0x2110('0x1f')][a7_0x2110('0x13')],_0x417e9a);if(environment_1[a7_0x2110('0x4c')]){output[a7_0x2110('0x3c')]({'title':'Extracting\x20artifacts','bodyLines':_0x569ddc});}yield _0x4803f5[a7_0x2110('0x1')](_0x12407b[a7_0x2110('0x1d')],_0x444ddf,_0x569ddc);output[a7_0x2110('0x4f')](getCommand(_0x417e9a));process[a7_0x2110('0x3e')][a7_0x2110('0x3b')](_0x444ddf[a7_0x2110('0x22')]);output[a7_0x2110('0xa')]();});}function getCommand(_0x1ad239){const _0x36eed5=_0x1ad239[a7_0x2110('0x2c')]['configuration']?':'+_0x1ad239[a7_0x2110('0x2c')][a7_0x2110('0x2d')]:'';return['nx','run',_0x1ad239[a7_0x2110('0x2c')][a7_0x2110('0x44')]+':'+_0x1ad239['target'][a7_0x2110('0x2c')]+_0x36eed5,(0x0,serializer_overrides_1[a7_0x2110('0x2b')])(_0x1ad239)]['join']('\x20');}const nxCloudDistributedTasksRunner=(_0xd187de,_0x1b14a8,_0x2316be)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){if(environment_1[a7_0x2110('0x4c')]){output['note']({'title':a7_0x2110('0xb')});}_0x1b14a8['lifeCycle']=new NoopLifeCycle();const _0x1bd8ff=(0x0,environment_1['getRunGroup'])();if(!_0x1bd8ff){(0x0,print_run_group_error_1['printRunGroupError'])();return process[a7_0x2110('0x32')](0x1);}const _0x236526=new e2e_encryption_1['E2EEncryption'](environment_1[a7_0x2110('0x4b')]||_0x1b14a8[a7_0x2110('0x48')]);const _0x36ce70=new error_reporter_api_1[(a7_0x2110('0x42'))](_0x1b14a8);const _0x322bb9=new file_storage_1['FileStorage'](_0x236526,_0x36ce70,!![]);const _0x5d52c3=new Cache(_0x1b14a8);const _0x55a004=new distributed_execution_api_1[(a7_0x2110('0x49'))](_0x1b14a8);try{const _0x3d9e72=getTaskGraph(_0x2316be,_0xd187de,_0x1b14a8);const _0x170421=yield runDistributedExecution(_0x55a004,_0x1b14a8,_0x2316be,_0x322bb9,_0x5d52c3,_0x1bd8ff,_0x3d9e72);if(_0x170421[a7_0x2110('0x41')]===0x0){output['success']({'title':a7_0x2110('0x36'),'bodyLines':['See\x20run\x20details\x20at\x20'+_0x170421[a7_0x2110('0x25')]]});}else{output[a7_0x2110('0x6')]({'title':a7_0x2110('0x40'),'bodyLines':['See\x20run\x20details\x20at\x20'+_0x170421[a7_0x2110('0x25')]]});}yield(0x0,metric_logger_1[a7_0x2110('0xc')])(_0x1b14a8);process[a7_0x2110('0x32')](_0x170421[a7_0x2110('0x41')]);}catch(_0x42b4e1){output['error']({'title':a7_0x2110('0x46'),'bodyLines':[_0x42b4e1[a7_0x2110('0x19')]]});if(_0x42b4e1[a7_0x2110('0x21')]){console['log'](_0x42b4e1[a7_0x2110('0x21')]);}else{console[a7_0x2110('0x47')](_0x42b4e1);}try{yield _0x55a004[a7_0x2110('0x4e')](_0x1bd8ff,a7_0x2110('0x28')+_0x42b4e1[a7_0x2110('0x19')]+'\x22');}finally{process['exit'](0x1);}}});exports[a7_0x2110('0x2')]=nxCloudDistributedTasksRunner;function getTaskGraph(_0x14b43f,_0x1698a1,_0x569fe6){if(_0x14b43f['taskGraph']){return _0x14b43f[a7_0x2110('0x5')];}else{const _0x1d4d8f=JSON[a7_0x2110('0x39')](stripJsonComments((0x0,fs_1['readFileSync'])(workspaceRoot+a7_0x2110('0x53'))['toString']()));return new task_graph_creator_1[(a7_0x2110('0x0'))](_0x14b43f[a7_0x2110('0x1f')],getDefaultDependencyConfigs(_0x1d4d8f,_0x569fe6))[a7_0x2110('0x20')](_0x1698a1);}}function getDefaultDependencyConfigs(_0x757c30,_0x2e73f4){var _0x2d2b59,_0xe4d8b3;const _0x348134=(_0x2d2b59=_0x757c30[a7_0x2110('0x30')])!==null&&_0x2d2b59!==void 0x0?_0x2d2b59:{};const _0x1fc672=_0x2e73f4?(_0xe4d8b3=_0x2e73f4['strictlyOrderedTargets'])!==null&&_0xe4d8b3!==void 0x0?_0xe4d8b3:['build']:[];for(const _0x261de0 of _0x1fc672){_0x348134[_0x261de0]=_0x348134[_0x261de0]||[];_0x348134[_0x261de0][a7_0x2110('0x51')]({'target':_0x261de0,'projects':a7_0x2110('0x33')});}return _0x348134;}