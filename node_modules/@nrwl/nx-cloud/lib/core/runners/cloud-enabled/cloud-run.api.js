const a3_0x3813=['done','Run\x20completion\x20responded\x20with\x20`undefined`.','post','apiAxiosInstance','urls','../../../utilities/nx-imports','mapRespToPerfEntry','application/octet-stream','api','createMetricRecorder','getBranch','__awaiter','/nx-cloud/runs/start','apiError','readFileSync','createReqBody','axiosException','throw','status','extractErrorMessage','string','messages','../../../utilities/environment','next','stringify','from','../../../utilities/metric-logger','recordMetric','machineInfo','startRun','value','Invalid\x20end\x20run\x20response','../../../utilities/axios','RUNNER_FAILURE_PERF_ENTRY','Stack\x20Trace:','/nx-cloud/runs/end','CloudRunApi','headers','data','terminalOutput','__esModule','@nrwl/nx-cloud','VERBOSE_LOGGING','success','response','Run\x20Details:','assign','gzip','unknown','message','note','parse','defaults','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','length','map','stack','toString','promisify','axiosMultipleTries','defineProperty','Invalid\x20end\x20run\x20response:\x20','RunStart','runUrl','runContext','endRun','then','nxCloudVersion','getRunGroup','devDependencies','error'];(function(_0x39ecab,_0x38131e){const _0x19cb67=function(_0x2a2bf7){while(--_0x2a2bf7){_0x39ecab['push'](_0x39ecab['shift']());}};_0x19cb67(++_0x38131e);}(a3_0x3813,0x157));const a3_0x19cb=function(_0x39ecab,_0x38131e){_0x39ecab=_0x39ecab-0x0;let _0x19cb67=a3_0x3813[_0x39ecab];return _0x19cb67;};'use strict';var __awaiter=this&&this[a3_0x19cb('0x17')]||function(_0x23034b,_0x4e00e1,_0x58685d,_0x1e126e){function _0x221890(_0x11dca3){return _0x11dca3 instanceof _0x58685d?_0x11dca3:new _0x58685d(function(_0xdff906){_0xdff906(_0x11dca3);});}return new(_0x58685d||(_0x58685d=Promise))(function(_0x431d28,_0x16398d){function _0x475434(_0x1f6389){try{_0x36f11c(_0x1e126e[a3_0x19cb('0x23')](_0x1f6389));}catch(_0x24e61b){_0x16398d(_0x24e61b);}}function _0x292f82(_0x36151a){try{_0x36f11c(_0x1e126e[a3_0x19cb('0x1d')](_0x36151a));}catch(_0x2609ab){_0x16398d(_0x2609ab);}}function _0x36f11c(_0xcaa2ec){_0xcaa2ec[a3_0x19cb('0xc')]?_0x431d28(_0xcaa2ec[a3_0x19cb('0x2a')]):_0x221890(_0xcaa2ec[a3_0x19cb('0x2a')])[a3_0x19cb('0x7')](_0x475434,_0x292f82);}_0x36f11c((_0x1e126e=_0x1e126e['apply'](_0x23034b,_0x4e00e1||[]))[a3_0x19cb('0x23')]());});};Object[a3_0x19cb('0x1')](exports,a3_0x19cb('0x34'),{'value':!![]});exports[a3_0x19cb('0x30')]=void 0x0;const axios_1=require(a3_0x19cb('0x2c'));const environment_1=require(a3_0x19cb('0x22'));const fs_1=require('fs');const zlib_1=require('zlib');const util_1=require('util');const metric_logger_1=require(a3_0x19cb('0x26'));const {output}=require(a3_0x19cb('0x11'));class CloudRunApi{constructor(_0x164411,_0x177598,_0x2eca4b,_0x13b644){this[a3_0x19cb('0x21')]=_0x164411;this[a3_0x19cb('0x5')]=_0x177598;this[a3_0x19cb('0x28')]=_0x13b644;this[a3_0x19cb('0xf')]=(0x0,axios_1['createApiAxiosInstance'])(_0x2eca4b);}[a3_0x19cb('0x29')](_0x4c5499,_0x18cb10){var _0x1a73a1;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1ce524=(0x0,metric_logger_1[a3_0x19cb('0x15')])(a3_0x19cb('0x29'));try{const _0x7534d6={'meta':{'nxCloudVersion':this[a3_0x19cb('0x8')]()},'branch':(0x0,environment_1[a3_0x19cb('0x16')])(),'runGroup':(0x0,environment_1[a3_0x19cb('0x9')])(),'distributedExecutionId':_0x4c5499,'hashes':_0x18cb10};if(environment_1[a3_0x19cb('0x36')]){output[a3_0x19cb('0x3e')]({'title':a3_0x19cb('0x3'),'bodyLines':['\x0a'+JSON[a3_0x19cb('0x24')](_0x7534d6,null,0x2)]});}const _0xd86279=yield(0x0,axios_1[a3_0x19cb('0x0')])(()=>this[a3_0x19cb('0xf')][a3_0x19cb('0xe')](a3_0x19cb('0x18'),_0x7534d6));_0x1ce524['recordMetric']((0x0,metric_logger_1[a3_0x19cb('0x12')])(_0xd86279));if(_0xd86279[a3_0x19cb('0x32')]&&_0xd86279[a3_0x19cb('0x32')][a3_0x19cb('0x3d')]){this[a3_0x19cb('0x21')][a3_0x19cb('0x3d')]=_0xd86279[a3_0x19cb('0x32')][a3_0x19cb('0x3d')];}if(!_0xd86279[a3_0x19cb('0x32')]||!_0xd86279['data'][a3_0x19cb('0x10')]){this[a3_0x19cb('0x21')][a3_0x19cb('0x19')]='Invalid\x20Nx\x20Cloud\x20response:\x20'+JSON[a3_0x19cb('0x24')](_0xd86279[a3_0x19cb('0x32')]);return{};}return _0xd86279[a3_0x19cb('0x32')][a3_0x19cb('0x10')];}catch(_0x41f958){_0x1ce524[a3_0x19cb('0x27')](((_0x1a73a1=_0x41f958===null||_0x41f958===void 0x0?void 0x0:_0x41f958[a3_0x19cb('0x1c')])===null||_0x1a73a1===void 0x0?void 0x0:_0x1a73a1[a3_0x19cb('0x38')])?(0x0,metric_logger_1[a3_0x19cb('0x12')])(_0x41f958['axiosException']['response']):metric_logger_1[a3_0x19cb('0x2d')]);this[a3_0x19cb('0x21')]['apiError']=this[a3_0x19cb('0x21')][a3_0x19cb('0x1f')](_0x41f958,a3_0x19cb('0x14'));return{};}});}[a3_0x19cb('0x1b')](_0x4ec1de,_0x26abee){const _0x4a506c={'meta':{'nxCloudVersion':this[a3_0x19cb('0x8')]()},'tasks':_0x26abee,'run':_0x4ec1de,'machineInfo':this['machineInfo']};return JSON[a3_0x19cb('0x24')](_0x4a506c);}[a3_0x19cb('0x6')](_0x3c5337,_0x2c81b4){var _0x2075f4,_0x9a4120;return __awaiter(this,void 0x0,void 0x0,function*(){if(this['messages'][a3_0x19cb('0x19')])return![];let _0xe7f66e=this[a3_0x19cb('0x1b')](_0x3c5337,_0x2c81b4);if(_0xe7f66e[a3_0x19cb('0x42')]>0x14*0x3e8*0x3e8){_0xe7f66e=this['createReqBody'](_0x3c5337,_0x2c81b4[a3_0x19cb('0x43')](_0x2b2581=>Object[a3_0x19cb('0x3a')](Object['assign']({},_0x2b2581),{'hashDetails':undefined})));}const _0x1630e8=Buffer[a3_0x19cb('0x25')](_0xe7f66e);const _0x7f2483=yield(0x0,util_1[a3_0x19cb('0x46')])(zlib_1[a3_0x19cb('0x3b')])(_0x1630e8);const _0x410b44=(0x0,metric_logger_1[a3_0x19cb('0x15')])(a3_0x19cb('0x6'));try{if(environment_1['VERBOSE_LOGGING']){const _0x404616=_0x2c81b4[a3_0x19cb('0x43')](_0x184a01=>{return Object[a3_0x19cb('0x3a')](Object[a3_0x19cb('0x3a')]({},_0x184a01),{'terminalOutput':_0x184a01[a3_0x19cb('0x33')]?_0x184a01[a3_0x19cb('0x33')]['slice'](0x0,0x14)+'...':undefined});});output[a3_0x19cb('0x3e')]({'title':'RunEnd.\x20Completed\x20tasks','bodyLines':['\x0a'+JSON[a3_0x19cb('0x24')](_0x404616,null,0x2)]});}const _0x1d7a8d=yield(0x0,axios_1[a3_0x19cb('0x0')])(()=>this[a3_0x19cb('0xf')][a3_0x19cb('0xe')](a3_0x19cb('0x2f'),_0x7f2483,{'headers':Object[a3_0x19cb('0x3a')](Object[a3_0x19cb('0x3a')]({},this['apiAxiosInstance'][a3_0x19cb('0x40')][a3_0x19cb('0x31')]),{'Content-Encoding':'gzip','Content-Type':a3_0x19cb('0x13')})}));if(_0x1d7a8d){_0x410b44[a3_0x19cb('0x27')]((0x0,metric_logger_1[a3_0x19cb('0x12')])(_0x1d7a8d));if(_0x1d7a8d[a3_0x19cb('0x32')]&&_0x1d7a8d[a3_0x19cb('0x32')][a3_0x19cb('0x4')]&&_0x1d7a8d[a3_0x19cb('0x32')][a3_0x19cb('0x1e')]===a3_0x19cb('0x37')){this[a3_0x19cb('0x5')][a3_0x19cb('0x4')]=_0x1d7a8d[a3_0x19cb('0x32')]['runUrl'];return!![];}if(_0x1d7a8d[a3_0x19cb('0x32')]&&_0x1d7a8d[a3_0x19cb('0x32')][a3_0x19cb('0x1e')]){this[a3_0x19cb('0x21')][a3_0x19cb('0x19')]=a3_0x19cb('0x2')+JSON['stringify'](_0x1d7a8d[a3_0x19cb('0x32')]['message']);}else if(_0x1d7a8d[a3_0x19cb('0x32')]&&typeof _0x1d7a8d['data']===a3_0x19cb('0x20')){if(_0x1d7a8d['data']!==a3_0x19cb('0x37')){this[a3_0x19cb('0x21')][a3_0x19cb('0x19')]=a3_0x19cb('0x2')+JSON[a3_0x19cb('0x24')](_0x1d7a8d['data']);}}else{this['messages'][a3_0x19cb('0x19')]=a3_0x19cb('0x2')+JSON['stringify'](_0x1d7a8d[a3_0x19cb('0x32')]);}if(environment_1[a3_0x19cb('0x36')]){output[a3_0x19cb('0x3e')]({'title':a3_0x19cb('0x2b'),'bodyLines':[JSON[a3_0x19cb('0x24')](_0x1d7a8d[a3_0x19cb('0x32')],null,0x2)]});}}else{output[a3_0x19cb('0xb')]({'title':a3_0x19cb('0x41'),'bodyLines':[a3_0x19cb('0xd'),a3_0x19cb('0x39'),JSON[a3_0x19cb('0x24')](_0x3c5337,null,0x2),a3_0x19cb('0x2e'),JSON[a3_0x19cb('0x24')](new Error()[a3_0x19cb('0x44')],null,0x2)]});}return![];}catch(_0x12c27a){_0x410b44['recordMetric'](((_0x2075f4=_0x12c27a===null||_0x12c27a===void 0x0?void 0x0:_0x12c27a[a3_0x19cb('0x1c')])===null||_0x2075f4===void 0x0?void 0x0:_0x2075f4['response'])?(0x0,metric_logger_1['mapRespToPerfEntry'])(_0x12c27a['axiosException'][a3_0x19cb('0x38')]):metric_logger_1[a3_0x19cb('0x2d')]);const _0x2cb5bd=(_0x9a4120=_0x12c27a[a3_0x19cb('0x1c')])!==null&&_0x9a4120!==void 0x0?_0x9a4120:_0x12c27a;this[a3_0x19cb('0x21')][a3_0x19cb('0x19')]=this[a3_0x19cb('0x21')][a3_0x19cb('0x1f')](_0x2cb5bd,a3_0x19cb('0x14'));return![];}});}[a3_0x19cb('0x8')](){try{const _0x953935=JSON[a3_0x19cb('0x3f')]((0x0,fs_1[a3_0x19cb('0x1a')])('package.json')[a3_0x19cb('0x45')]());return _0x953935[a3_0x19cb('0xa')][a3_0x19cb('0x35')];}catch(_0x41fe09){return a3_0x19cb('0x3c');}}}exports[a3_0x19cb('0x30')]=CloudRunApi;